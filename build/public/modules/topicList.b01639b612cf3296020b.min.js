"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8704,613],{29412:(L,P,u)=>{var E,C;E=[u(69941),u(60392),u(7237),u(74344),u(31369),u(7927)],C=function(v,w,a,f,A,p){const o={};o.init=function(){v.init(s),i(),a.get("topic/delete").on("click",function(){return l("del","/state","delete",d),!1}),a.get("topic/restore").on("click",function(){return l("put","/state","restore",d),!1}),a.get("topic/purge").on("click",function(){return l("del","","purge",d),!1}),a.get("topic/lock").on("click",function(){return l("put","/lock","lock",n),!1}),a.get("topic/unlock").on("click",function(){return l("del","/lock","unlock",n),!1}),a.get("topic/pin").on("click",function(){return l("put","/pin","pin",n),!1}),a.get("topic/unpin").on("click",function(){return l("del","/pin","unpin",n),!1}),a.get("topic/mark-unread-for-all").on("click",function(){const e=v.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(t){if(t)return p.error(t);p.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(c){$('[component="category/topic"][data-tid="'+c+'"]').addClass("unread")}),n()}),!1):p.error("[[error:no-topics-selected]]")}),a.get("topic/move").on("click",function(){return u.e(7378).then(function(){var e=[u(57378)];(function(t){const c=v.getSelectedTids();if(!c.length)return p.error("[[error:no-topics-selected]]");t.init(c,null,n)}).apply(null,e)}).catch(u.oe),!1}),a.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return p.error("[[error:invalid-data]]");u.e(7378).then(function(){var t=[u(57378)];(function(c){c.init(null,e,function(g){if(g)return p.error(g);ajaxify.refresh()})}).apply(null,t)}).catch(u.oe)}),a.get("topic/merge").on("click",function(){const e=v.getSelectedTids();u.e(28).then(function(){var t=[u(90028)];(function(c){c.init(function(){e.length&&e.forEach(function(g){c.addTopic(g)})})}).apply(null,t)}).catch(u.oe)}),o.removeListeners(),socket.on("event:topic_deleted",R),socket.on("event:topic_restored",R),socket.on("event:topic_purged",W),socket.on("event:topic_locked",M),socket.on("event:topic_unlocked",M),socket.on("event:topic_pinned",S),socket.on("event:topic_unpinned",S),socket.on("event:topic_moved",B)};function l(e,t,c,g){g||(g=function(){});const h=v.getSelectedTids(),m={},k=function(I){I&&Promise.all(h.map(T=>f[e](`/topics/${T}${t}`,m))).then(g).catch(p.error)};if(!h.length)return p.error("[[error:no-topics-selected]]");switch(c){case"delete":case"restore":case"purge":A.confirm(`[[topic:thread_tools.${c}_confirm]]`,k);break;case"pin":w.requestPinExpiry(m,k.bind(null,!0));break;default:k(!0);break}}o.removeListeners=function(){socket.removeListener("event:topic_deleted",R),socket.removeListener("event:topic_restored",R),socket.removeListener("event:topic_purged",W),socket.removeListener("event:topic_locked",M),socket.removeListener("event:topic_unlocked",M),socket.removeListener("event:topic_pinned",S),socket.removeListener("event:topic_unpinned",S),socket.removeListener("event:topic_moved",B)};function r(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function n(){r(),v.unselectAll()}function d(){r(),s()}function s(){const e=v.getSelectedTids(),t=y(F,e),c=D(F,e),g=y(b,e),h=y(j,e),m=y(N,e),k=D(N,e);a.get("topic/delete").toggleClass("hidden",t),a.get("topic/restore").toggleClass("hidden",m||!t),a.get("topic/purge").toggleClass("hidden",!c),a.get("topic/lock").toggleClass("hidden",h),a.get("topic/unlock").toggleClass("hidden",!h),a.get("topic/pin").toggleClass("hidden",k||g),a.get("topic/unpin").toggleClass("hidden",k||!g),a.get("topic/merge").toggleClass("hidden",m)}function y(e,t){for(let c=0;c<t.length;c+=1)if(e(t[c]))return!0;return!1}function D(e,t){for(let c=0;c<t.length;c+=1)if(!e(t[c]))return!1;return!0}function F(e){return x(e).hasClass("deleted")}function j(e){return x(e).hasClass("locked")}function b(e){return x(e).hasClass("pinned")}function N(e){return x(e).hasClass("scheduled")}function x(e){return a.get("category/topic","tid",e)}function R(e){const t=x(e.tid);t.toggleClass("deleted",e.isDeleted),t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function S(e){const t=x(e.tid);t.toggleClass("pinned",e.isPinned),t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned),ajaxify.refresh()}function M(e){const t=x(e.tid);t.toggleClass("locked",e.isLocked),t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function B(e){x(e.tid).remove()}function W(e){x(e.tid).remove()}function i(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(t=>t.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const t=$('[component="category"]').filter(function(g,h){return!$(h).parents("[widget-area],[data-widget-area]").length});let c=0;t.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){c=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(g,h){socket.emit("topics.orderPinnedTopics",{tid:h.item.attr("data-tid"),order:c+h.item.index()},function(m){if(m)return p.error(m);t.find('[component="category/topic"].pinned').each((k,I)=>{$(I).attr("data-index",c+k)})})}})})}return o}.apply(P,E),C!==void 0&&(L.exports=C)},39941:(L,P,u)=>{var E,C;E=[u(22905),u(74344),u(85233)],C=function(v,w,a){const f={};f.init=function(p,o){if(!p||!p.length)return;o=o||{},o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-filter",a.fire("action:category.filter.options",{el:p,options:o}),v.init(p,o);let l=[],r=[];Array.isArray(o.selectedCids)?l=o.selectedCids.map(n=>parseInt(n,10)):Array.isArray(ajaxify.data.selectedCids)&&(l=ajaxify.data.selectedCids.map(n=>parseInt(n,10))),r=l.slice(),p.on("hidden.bs.dropdown",function(){let n=r.length!==l.length;if(r.forEach(function(d,s){d!==l[s]&&(n=!0)}),n&&A(p,l),o.onHidden){o.onHidden({changed:n,selectedCids:l.slice()});return}if(n){let d=window.location.pathname;const s=utils.params();l.length&&(s.cid=l,d+="?"+decodeURIComponent($.param(s))),ajaxify.go(d)}}),p.on("click",'[component="category/list"] [data-cid]',function(){const n=p.find('[component="category/list"]'),d=$(this),s=d.find("a").attr("href");if(s&&s!=="#"&&s.length)return;const y=parseInt(d.attr("data-cid"),10),D=d.find('[component="category/select/icon"]');return l.includes(y)?l.splice(l.indexOf(y),1):l.push(y),l.sort(function(F,j){return F-j}),o.selectedCids=l,D.toggleClass("invisible"),n.find('li[data-all="all"] i').toggleClass("invisible",!!l.length),o.onSelect&&o.onSelect({cid:y,selectedCids:l.slice()}),!1})};function A(p,o){o.length>1?l({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):o.length===1?w.get(`/categories/${o[0]}`,{}).then(l):l();function l(r){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:r},function(n){p.find("button").replaceWith($("<div/>").html(n).find("button"))})}}return f}.apply(P,E),C!==void 0&&(L.exports=C)},22905:(L,P,u)=>{var E,C;E=[u(7927)],C=function(v){const w={};return w.init=function(a,f){let A=null;f=f||{},f.privilege=f.privilege||"topics:read",f.states=f.states||["watching","notwatching","ignoring"];let p=[];Array.isArray(f.localCategories)&&(p=f.localCategories.map(d=>({...d}))),f.selectedCids=f.selectedCids||ajaxify.data.selectedCids||[];const o=a.find('[component="category-selector-search"]');if(!o.length)return;const l=o.parent('[component="category/dropdown"]').length>0||o.parent('[component="category-selector"]').length>0;a.on("show.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").addClass("hidden"),o.removeClass("hidden"));function d(){const s=o.find("input").val();s.length>1||!s&&!A?r(s,function(y){A=A||y,n(y)}):!s&&A&&(A.forEach(function(y){y.selected=f.selectedCids.includes(y.cid)}),n(A))}o.on("click",function(s){s.preventDefault(),s.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(d,300)),d()}),a.on("shown.bs.dropdown",function(){o.find("input").focus()}),a.on("hide.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").removeClass("hidden"),o.addClass("hidden")),o.off("click"),o.find("input").off("keyup")});function r(d,s){socket.emit("categories.categorySearch",{search:d,query:utils.params(),parentCid:f.parentCid||0,selectedCids:f.selectedCids,privilege:f.privilege,states:f.states,showLinks:f.showLinks},function(y,D){if(y)return v.error(y);s(p.concat(D))})}function n(d){app.parseAndTranslate(f.template,{categoryItems:d.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){a.find('[component="category/list"]').replaceWith(s.find('[component="category/list"]')),a.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!d.length)})}},w}.apply(P,E),C!==void 0&&(L.exports=C)},14745:(L,P,u)=>{var E,C;E=[u(25142),u(66044),u(69941),u(39941),u(29412),u(85233)],C=function(v,w,a,f,A,p){const o={};let l="",r=0,n=0,d,s;const y=[];$(window).on("action:ajaxify.start",function(){o.removeListeners(),A.removeListeners()}),o.init=function(i,e){console.log(),console.log("INIT"),s=b(),l=i,d=e||M,A.init(),F(),o.watchForNewPosts();const t=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?t.push("notwatching","ignoring"):i!=="unread"&&t.push("notwatching"),f.init($('[component="category/dropdown"]'),{states:t}),config.usePagination||v.init(o.loadMoreTopics),w.init(function(c,g){d(c,1,function(h,m){W(l,h.topics,ajaxify.data.showSelect,1,function(){g(),m()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){o.loadMoreTopics(1)}),p.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function D(){console.log("RESET"),location.reload()}function F(){$("#post-search").on("input propertychange",utils.debounce(async function(){if(!$("#post-search").val().length)return D();const i=$("#post-search").val();console.log(i),console.log("----------"),j([],!0)},250))}function j(i,e,t){console.log("ONpostsLOADED"),console.log(i),t=t||function(){},app.parseAndTranslate("topics","topics",{posts:i},function(c){$(".topic-list")[e?"html":"append"](c),utils.makeNumbersHumanReadable(c.find(".human-readable-number")),t()})}function b(){return $('[component="category"]').filter(function(i,e){return!$(e).parents("[widget-area],[data-widget-area]").length})}o.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),n=0,r=0,o.removeListeners(),socket.on("event:new_topic",N),socket.on("event:new_post",x)},o.removeListeners=function(){socket.removeListener("event:new_topic",N),socket.removeListener("event:new_post",x)};function N(i){const e=ajaxify.data,t=e.selectedCids&&e.selectedCids.length&&e.selectedCids.indexOf(parseInt(i.cid,10))===-1,c=e.selectedFilter&&e.selectedFilter.filter==="watched",g=e.template.category&&parseInt(e.cid,10)!==parseInt(i.cid,10),h=!!(t||c||g||y.includes(i.tid));p.fire("filter:topicList.onNewTopic",{topic:i,preventAlert:h}).then(m=>{m.preventAlert||(i.scheduled&&i.tid&&y.push(i.tid),r+=1,R())})}function x(i){const e=i.posts[0];if(!e||!e.topic||e.topic.isFollowing)return;const t=ajaxify.data,c=parseInt(e.topic.mainPid,10)===parseInt(e.pid,10),g=t.selectedCids&&t.selectedCids.length&&t.selectedCids.indexOf(parseInt(e.topic.cid,10))===-1,h=t.selectedFilter&&t.selectedFilter.filter==="new",m=t.selectedFilter&&t.selectedFilter.filter==="watched"&&!e.topic.isFollowing,k=t.template.category&&parseInt(t.cid,10)!==parseInt(e.topic.cid,10),I=!!(c||g||h||m||k);p.fire("filter:topicList.onNewPost",{post:e,preventAlert:I}).then(T=>{T.preventAlert||(n+=1,R())})}function R(){let i="";r===0?n===1?i="[[recent:there-is-a-new-post]]":n>1&&(i="[[recent:there-are-new-posts, "+n+"]]"):r===1?n===0?i="[[recent:there-is-a-new-topic]]":n===1?i="[[recent:there-is-a-new-topic-and-a-new-post]]":n>1&&(i="[[recent:there-is-a-new-topic-and-new-posts, "+n+"]]"):r>1&&(n===0?i="[[recent:there-are-new-topics, "+r+"]]":n===1?i="[[recent:there-are-new-topics-and-a-new-post, "+r+"]]":n>1&&(i="[[recent:there-are-new-topics-and-new-posts, "+r+", "+n+"]]")),i+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(i).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}o.loadMoreTopics=function(i){if(!s.length||!s.children().length)return;const e=s.find('[component="category/topic"]'),t=i>0?e.last():e.first(),c=(parseInt(t.attr("data-index"),10)||0)+(i>0?1:0);!utils.isNumber(c)||c===0&&s.find('[component="category/topic"][data-index="0"]').length||d(c,i,function(g,h){W(l,g.topics,ajaxify.data.showSelect,i,h)})};function S(i,e){return Math.floor(i/config.topicsPerPage)+(e>0?1:0)}function M(i,e,t){t=t||function(){};const c=utils.params();c.page=S(i,e),v.loadMoreXhr(c,t)}function B(i){return i.filter(function(e){return!s.find('[component="category/topic"][data-tid="'+e.tid+'"]').length})}function W(i,e,t,c,g){if(!e||!e.length||(e=B(e),!e.length))return $("#load-more-btn").hide(),g();let h,m;const k=s.find('[component="category/topic"]');c>0&&e.length?h=k.last():c<0&&e.length&&(m=k.first());const I={topics:e,showSelect:t,template:{name:i}};I.template[i]=!0,p.fire("action:topics.loading",{topics:e,after:h,before:m}),app.parseAndTranslate(i,"topics",I,function(T){if(s.removeClass("hidden"),$("#category-no-topics").remove(),h&&h.length)T.insertAfter(h);else if(m&&m.length){const U=$(document).height(),K=$(window).scrollTop();T.insertBefore(m),$(window).scrollTop(K+($(document).height()-U))}else s.append(T);a.getSelectedTids().length||v.removeExtra(s.find('[component="category/topic"]'),c,Math.max(60,config.topicsPerPage*3)),T.find(".timeago").timeago(),app.createUserTooltips(T),utils.makeNumbersHumanReadable(T.find(".human-readable-number")),p.fire("action:topics.loaded",{topics:e,template:i}),g()})}return o}.apply(P,E),C!==void 0&&(L.exports=C)},69941:(L,P,u)=>{var E,C;E=[u(7237)],C=function(v){const w={};let a,f;w.init=function(r){f=$('[component="category"]'),f.on("selectstart",'[component="topic/select"]',function(n){n.preventDefault()}),f.on("click",'[component="topic/select"]',function(n){const d=$(this);if(n.shiftKey)return p($(this).parents('[component="category/topic"]').attr("data-tid")),a=d,!1;const s=d.parents("[data-tid]").hasClass("selected");A(d,!s),a=d,typeof r=="function"&&r()})};function A(r,n){r.toggleClass("fa-check-square-o",n),r.toggleClass("fa-square-o",!n),r.parents('[component="category/topic"]').toggleClass("selected",n)}w.getSelectedTids=function(){const r=[];return f&&f.find('[component="category/topic"].selected').each(function(){r.push($(this).attr("data-tid"))}),r},w.unselectAll=function(){f&&(f.find('[component="category/topic"].selected').removeClass("selected"),f.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function p(r){a||(a=$('[component="category/topic"]').first().find('[component="topic/select"]'));const n=v.get("category/topic","tid",r).hasClass("selected"),d=l(r),s=l(a.parents('[component="category/topic"]').attr("data-tid"));o(d,s,!n)}function o(r,n,d){if(r>n){const s=r;r=n,n=s}for(let s=r;s<=n;s+=1){const y=$('[component="category/topic"]').eq(s);A(y.find('[component="topic/select"]'),d)}}function l(r){return v.get("category/topic","tid",r).index('[component="category/topic"]')}return w}.apply(P,E),C!==void 0&&(L.exports=C)}}]);
