"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8704,613],{29412:(L,P,u)=>{var E,C;E=[u(69941),u(60392),u(7237),u(74344),u(31369),u(7927)],C=function(v,w,a,f,A,p){const c={};c.init=function(){v.init(s),o(),a.get("topic/delete").on("click",function(){return l("del","/state","delete",d),!1}),a.get("topic/restore").on("click",function(){return l("put","/state","restore",d),!1}),a.get("topic/purge").on("click",function(){return l("del","","purge",d),!1}),a.get("topic/lock").on("click",function(){return l("put","/lock","lock",i),!1}),a.get("topic/unlock").on("click",function(){return l("del","/lock","unlock",i),!1}),a.get("topic/pin").on("click",function(){return l("put","/pin","pin",i),!1}),a.get("topic/unpin").on("click",function(){return l("del","/pin","unpin",i),!1}),a.get("topic/mark-unread-for-all").on("click",function(){const e=v.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(t){if(t)return p.error(t);p.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(n){$('[component="category/topic"][data-tid="'+n+'"]').addClass("unread")}),i()}),!1):p.error("[[error:no-topics-selected]]")}),a.get("topic/move").on("click",function(){return u.e(7378).then(function(){var e=[u(57378)];(function(t){const n=v.getSelectedTids();if(!n.length)return p.error("[[error:no-topics-selected]]");t.init(n,null,i)}).apply(null,e)}).catch(u.oe),!1}),a.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return p.error("[[error:invalid-data]]");u.e(7378).then(function(){var t=[u(57378)];(function(n){n.init(null,e,function(g){if(g)return p.error(g);ajaxify.refresh()})}).apply(null,t)}).catch(u.oe)}),a.get("topic/merge").on("click",function(){const e=v.getSelectedTids();u.e(28).then(function(){var t=[u(90028)];(function(n){n.init(function(){e.length&&e.forEach(function(g){n.addTopic(g)})})}).apply(null,t)}).catch(u.oe)}),c.removeListeners(),socket.on("event:topic_deleted",R),socket.on("event:topic_restored",R),socket.on("event:topic_purged",b),socket.on("event:topic_locked",j),socket.on("event:topic_unlocked",j),socket.on("event:topic_pinned",S),socket.on("event:topic_unpinned",S),socket.on("event:topic_moved",W)};function l(e,t,n,g){g||(g=function(){});const h=v.getSelectedTids(),y={},k=function(I){I&&Promise.all(h.map(T=>f[e](`/topics/${T}${t}`,y))).then(g).catch(p.error)};if(!h.length)return p.error("[[error:no-topics-selected]]");switch(n){case"delete":case"restore":case"purge":A.confirm(`[[topic:thread_tools.${n}_confirm]]`,k);break;case"pin":w.requestPinExpiry(y,k.bind(null,!0));break;default:k(!0);break}}c.removeListeners=function(){socket.removeListener("event:topic_deleted",R),socket.removeListener("event:topic_restored",R),socket.removeListener("event:topic_purged",b),socket.removeListener("event:topic_locked",j),socket.removeListener("event:topic_unlocked",j),socket.removeListener("event:topic_pinned",S),socket.removeListener("event:topic_unpinned",S),socket.removeListener("event:topic_moved",W)};function r(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function i(){r(),v.unselectAll()}function d(){r(),s()}function s(){const e=v.getSelectedTids(),t=m(F,e),n=D(F,e),g=m(B,e),h=m(M,e),y=m(N,e),k=D(N,e);a.get("topic/delete").toggleClass("hidden",t),a.get("topic/restore").toggleClass("hidden",y||!t),a.get("topic/purge").toggleClass("hidden",!n),a.get("topic/lock").toggleClass("hidden",h),a.get("topic/unlock").toggleClass("hidden",!h),a.get("topic/pin").toggleClass("hidden",k||g),a.get("topic/unpin").toggleClass("hidden",k||!g),a.get("topic/merge").toggleClass("hidden",y)}function m(e,t){for(let n=0;n<t.length;n+=1)if(e(t[n]))return!0;return!1}function D(e,t){for(let n=0;n<t.length;n+=1)if(!e(t[n]))return!1;return!0}function F(e){return x(e).hasClass("deleted")}function M(e){return x(e).hasClass("locked")}function B(e){return x(e).hasClass("pinned")}function N(e){return x(e).hasClass("scheduled")}function x(e){return a.get("category/topic","tid",e)}function R(e){const t=x(e.tid);t.toggleClass("deleted",e.isDeleted),t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function S(e){const t=x(e.tid);t.toggleClass("pinned",e.isPinned),t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned),ajaxify.refresh()}function j(e){const t=x(e.tid);t.toggleClass("locked",e.isLocked),t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function W(e){x(e.tid).remove()}function b(e){x(e.tid).remove()}function o(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(t=>t.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const t=$('[component="category"]').filter(function(g,h){return!$(h).parents("[widget-area],[data-widget-area]").length});let n=0;t.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){n=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(g,h){socket.emit("topics.orderPinnedTopics",{tid:h.item.attr("data-tid"),order:n+h.item.index()},function(y){if(y)return p.error(y);t.find('[component="category/topic"].pinned').each((k,I)=>{$(I).attr("data-index",n+k)})})}})})}return c}.apply(P,E),C!==void 0&&(L.exports=C)},39941:(L,P,u)=>{var E,C;E=[u(22905),u(74344),u(85233)],C=function(v,w,a){const f={};f.init=function(p,c){if(!p||!p.length)return;c=c||{},c.states=c.states||["watching","notwatching","ignoring"],c.template="partials/category-filter",a.fire("action:category.filter.options",{el:p,options:c}),v.init(p,c);let l=[],r=[];Array.isArray(c.selectedCids)?l=c.selectedCids.map(i=>parseInt(i,10)):Array.isArray(ajaxify.data.selectedCids)&&(l=ajaxify.data.selectedCids.map(i=>parseInt(i,10))),r=l.slice(),p.on("hidden.bs.dropdown",function(){let i=r.length!==l.length;if(r.forEach(function(d,s){d!==l[s]&&(i=!0)}),i&&A(p,l),c.onHidden){c.onHidden({changed:i,selectedCids:l.slice()});return}if(i){let d=window.location.pathname;const s=utils.params();l.length&&(s.cid=l,d+="?"+decodeURIComponent($.param(s))),ajaxify.go(d)}}),p.on("click",'[component="category/list"] [data-cid]',function(){const i=p.find('[component="category/list"]'),d=$(this),s=d.find("a").attr("href");if(s&&s!=="#"&&s.length)return;const m=parseInt(d.attr("data-cid"),10),D=d.find('[component="category/select/icon"]');return l.includes(m)?l.splice(l.indexOf(m),1):l.push(m),l.sort(function(F,M){return F-M}),c.selectedCids=l,D.toggleClass("invisible"),i.find('li[data-all="all"] i').toggleClass("invisible",!!l.length),c.onSelect&&c.onSelect({cid:m,selectedCids:l.slice()}),!1})};function A(p,c){c.length>1?l({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):c.length===1?w.get(`/categories/${c[0]}`,{}).then(l):l();function l(r){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:r},function(i){p.find("button").replaceWith($("<div/>").html(i).find("button"))})}}return f}.apply(P,E),C!==void 0&&(L.exports=C)},22905:(L,P,u)=>{var E,C;E=[u(7927)],C=function(v){const w={};return w.init=function(a,f){let A=null;f=f||{},f.privilege=f.privilege||"topics:read",f.states=f.states||["watching","notwatching","ignoring"];let p=[];Array.isArray(f.localCategories)&&(p=f.localCategories.map(d=>({...d}))),f.selectedCids=f.selectedCids||ajaxify.data.selectedCids||[];const c=a.find('[component="category-selector-search"]');if(!c.length)return;const l=c.parent('[component="category/dropdown"]').length>0||c.parent('[component="category-selector"]').length>0;a.on("show.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").addClass("hidden"),c.removeClass("hidden"));function d(){const s=c.find("input").val();s.length>1||!s&&!A?r(s,function(m){A=A||m,i(m)}):!s&&A&&(A.forEach(function(m){m.selected=f.selectedCids.includes(m.cid)}),i(A))}c.on("click",function(s){s.preventDefault(),s.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(d,300)),d()}),a.on("shown.bs.dropdown",function(){c.find("input").focus()}),a.on("hide.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").removeClass("hidden"),c.addClass("hidden")),c.off("click"),c.find("input").off("keyup")});function r(d,s){socket.emit("categories.categorySearch",{search:d,query:utils.params(),parentCid:f.parentCid||0,selectedCids:f.selectedCids,privilege:f.privilege,states:f.states,showLinks:f.showLinks},function(m,D){if(m)return v.error(m);s(p.concat(D))})}function i(d){app.parseAndTranslate(f.template,{categoryItems:d.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){a.find('[component="category/list"]').replaceWith(s.find('[component="category/list"]')),a.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!d.length)})}},w}.apply(P,E),C!==void 0&&(L.exports=C)},14745:(L,P,u)=>{var E,C;E=[u(25142),u(66044),u(69941),u(39941),u(29412),u(85233)],C=function(v,w,a,f,A,p){const c={};let l="",r=0,i=0,d,s;const m=[];$(window).on("action:ajaxify.start",function(){c.removeListeners(),A.removeListeners()}),c.init=function(o,e){s=B(),l=o,d=e||j,A.init(),F(),c.watchForNewPosts();const t=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?t.push("notwatching","ignoring"):o!=="unread"&&t.push("notwatching"),f.init($('[component="category/dropdown"]'),{states:t}),config.usePagination||v.init(c.loadMoreTopics),w.init(function(n,g){d(n,1,function(h,y){b(l,h.topics,ajaxify.data.showSelect,1,function(){g(),y()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){c.loadMoreTopics(1)}),p.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function D(o,e,t){t=t||function(){},app.parseAndTranslate("partials/topics_list","topics",{topics:o},function(n){$(".topic-list")[e?"html":"append"](n),utils.makeNumbersHumanReadable(n.find(".human-readable-number")),t()})}function F(){$("#post-search").on("input propertychange",utils.debounce(async function(){const o=$("#post-search").val(),e=ajaxify.data.topics;o.length||D(e,!0);const t=[];e.forEach(n=>{n.title==o&&t.push(n)}),M(t,!0)},250))}function M(o,e,t){t=t||function(){},app.parseAndTranslate("partials/topics_list","topics",{topics:o},function(n){$(".topic-list")[e?"html":"append"](n),utils.makeNumbersHumanReadable(n.find(".human-readable-number")),t()})}function B(){return $('[component="category"]').filter(function(o,e){return!$(e).parents("[widget-area],[data-widget-area]").length})}c.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),i=0,r=0,c.removeListeners(),socket.on("event:new_topic",N),socket.on("event:new_post",x)},c.removeListeners=function(){socket.removeListener("event:new_topic",N),socket.removeListener("event:new_post",x)};function N(o){const e=ajaxify.data,t=e.selectedCids&&e.selectedCids.length&&e.selectedCids.indexOf(parseInt(o.cid,10))===-1,n=e.selectedFilter&&e.selectedFilter.filter==="watched",g=e.template.category&&parseInt(e.cid,10)!==parseInt(o.cid,10),h=!!(t||n||g||m.includes(o.tid));p.fire("filter:topicList.onNewTopic",{topic:o,preventAlert:h}).then(y=>{y.preventAlert||(o.scheduled&&o.tid&&m.push(o.tid),r+=1,R())})}function x(o){const e=o.posts[0];if(!e||!e.topic||e.topic.isFollowing)return;const t=ajaxify.data,n=parseInt(e.topic.mainPid,10)===parseInt(e.pid,10),g=t.selectedCids&&t.selectedCids.length&&t.selectedCids.indexOf(parseInt(e.topic.cid,10))===-1,h=t.selectedFilter&&t.selectedFilter.filter==="new",y=t.selectedFilter&&t.selectedFilter.filter==="watched"&&!e.topic.isFollowing,k=t.template.category&&parseInt(t.cid,10)!==parseInt(e.topic.cid,10),I=!!(n||g||h||y||k);p.fire("filter:topicList.onNewPost",{post:e,preventAlert:I}).then(T=>{T.preventAlert||(i+=1,R())})}function R(){let o="";r===0?i===1?o="[[recent:there-is-a-new-post]]":i>1&&(o="[[recent:there-are-new-posts, "+i+"]]"):r===1?i===0?o="[[recent:there-is-a-new-topic]]":i===1?o="[[recent:there-is-a-new-topic-and-a-new-post]]":i>1&&(o="[[recent:there-is-a-new-topic-and-new-posts, "+i+"]]"):r>1&&(i===0?o="[[recent:there-are-new-topics, "+r+"]]":i===1?o="[[recent:there-are-new-topics-and-a-new-post, "+r+"]]":i>1&&(o="[[recent:there-are-new-topics-and-new-posts, "+r+", "+i+"]]")),o+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(o).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}c.loadMoreTopics=function(o){if(!s.length||!s.children().length)return;const e=s.find('[component="category/topic"]'),t=o>0?e.last():e.first(),n=(parseInt(t.attr("data-index"),10)||0)+(o>0?1:0);!utils.isNumber(n)||n===0&&s.find('[component="category/topic"][data-index="0"]').length||d(n,o,function(g,h){b(l,g.topics,ajaxify.data.showSelect,o,h)})};function S(o,e){return Math.floor(o/config.topicsPerPage)+(e>0?1:0)}function j(o,e,t){t=t||function(){};const n=utils.params();n.page=S(o,e),v.loadMoreXhr(n,t)}function W(o){return o.filter(function(e){return!s.find('[component="category/topic"][data-tid="'+e.tid+'"]').length})}function b(o,e,t,n,g){if(!e||!e.length||(e=W(e),!e.length))return $("#load-more-btn").hide(),g();let h,y;const k=s.find('[component="category/topic"]');n>0&&e.length?h=k.last():n<0&&e.length&&(y=k.first());const I={topics:e,showSelect:t,template:{name:o}};I.template[o]=!0,p.fire("action:topics.loading",{topics:e,after:h,before:y}),app.parseAndTranslate(o,"topics",I,function(T){if(s.removeClass("hidden"),$("#category-no-topics").remove(),h&&h.length)T.insertAfter(h);else if(y&&y.length){const U=$(document).height(),K=$(window).scrollTop();T.insertBefore(y),$(window).scrollTop(K+($(document).height()-U))}else s.append(T);a.getSelectedTids().length||v.removeExtra(s.find('[component="category/topic"]'),n,Math.max(60,config.topicsPerPage*3)),T.find(".timeago").timeago(),app.createUserTooltips(T),utils.makeNumbersHumanReadable(T.find(".human-readable-number")),p.fire("action:topics.loaded",{topics:e,template:o}),g()})}return c}.apply(P,E),C!==void 0&&(L.exports=C)},69941:(L,P,u)=>{var E,C;E=[u(7237)],C=function(v){const w={};let a,f;w.init=function(r){f=$('[component="category"]'),f.on("selectstart",'[component="topic/select"]',function(i){i.preventDefault()}),f.on("click",'[component="topic/select"]',function(i){const d=$(this);if(i.shiftKey)return p($(this).parents('[component="category/topic"]').attr("data-tid")),a=d,!1;const s=d.parents("[data-tid]").hasClass("selected");A(d,!s),a=d,typeof r=="function"&&r()})};function A(r,i){r.toggleClass("fa-check-square-o",i),r.toggleClass("fa-square-o",!i),r.parents('[component="category/topic"]').toggleClass("selected",i)}w.getSelectedTids=function(){const r=[];return f&&f.find('[component="category/topic"].selected').each(function(){r.push($(this).attr("data-tid"))}),r},w.unselectAll=function(){f&&(f.find('[component="category/topic"].selected').removeClass("selected"),f.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function p(r){a||(a=$('[component="category/topic"]').first().find('[component="topic/select"]'));const i=v.get("category/topic","tid",r).hasClass("selected"),d=l(r),s=l(a.parents('[component="category/topic"]').attr("data-tid"));c(d,s,!i)}function c(r,i,d){if(r>i){const s=r;r=i,i=s}for(let s=r;s<=i;s+=1){const m=$('[component="category/topic"]').eq(s);A(m.find('[component="topic/select"]'),d)}}function l(r){return v.get("category/topic","tid",r).index('[component="category/topic"]')}return w}.apply(P,E),C!==void 0&&(L.exports=C)}}]);
