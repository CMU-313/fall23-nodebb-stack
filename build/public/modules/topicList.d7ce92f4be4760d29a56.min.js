"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8704,613],{29412:(P,D,g)=>{var x,m;x=[g(69941),g(60392),g(7237),g(74344),g(31369),g(7927)],m=function(C,T,a,p,E,u){const n={};n.init=function(){C.init(s),v(),a.get("topic/delete").on("click",function(){return l("del","/state","delete",f),!1}),a.get("topic/restore").on("click",function(){return l("put","/state","restore",f),!1}),a.get("topic/purge").on("click",function(){return l("del","","purge",f),!1}),a.get("topic/lock").on("click",function(){return l("put","/lock","lock",t),!1}),a.get("topic/unlock").on("click",function(){return l("del","/lock","unlock",t),!1}),a.get("topic/pin").on("click",function(){return l("put","/pin","pin",t),!1}),a.get("topic/unpin").on("click",function(){return l("del","/pin","unpin",t),!1}),a.get("topic/mark-unread-for-all").on("click",function(){const e=C.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(o){if(o)return u.error(o);u.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(d){$('[component="category/topic"][data-tid="'+d+'"]').addClass("unread")}),t()}),!1):u.error("[[error:no-topics-selected]]")}),a.get("topic/move").on("click",function(){return g.e(7378).then(function(){var e=[g(57378)];(function(o){const d=C.getSelectedTids();if(!d.length)return u.error("[[error:no-topics-selected]]");o.init(d,null,t)}).apply(null,e)}).catch(g.oe),!1}),a.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return u.error("[[error:invalid-data]]");g.e(7378).then(function(){var o=[g(57378)];(function(d){d.init(null,e,function(A){if(A)return u.error(A);ajaxify.refresh()})}).apply(null,o)}).catch(g.oe)}),a.get("topic/merge").on("click",function(){const e=C.getSelectedTids();g.e(28).then(function(){var o=[g(90028)];(function(d){d.init(function(){e.length&&e.forEach(function(A){d.addTopic(A)})})}).apply(null,o)}).catch(g.oe)}),n.removeListeners(),socket.on("event:topic_deleted",j),socket.on("event:topic_restored",j),socket.on("event:topic_purged",h),socket.on("event:topic_locked",i),socket.on("event:topic_unlocked",i),socket.on("event:topic_pinned",F),socket.on("event:topic_unpinned",F),socket.on("event:topic_moved",c)};function l(e,o,d,A){A||(A=function(){});const k=C.getSelectedTids(),w={},L=function(N){N&&Promise.all(k.map(U=>p[e](`/topics/${U}${o}`,w))).then(A).catch(u.error)};if(!k.length)return u.error("[[error:no-topics-selected]]");switch(d){case"delete":case"restore":case"purge":E.confirm(`[[topic:thread_tools.${d}_confirm]]`,L);break;case"pin":T.requestPinExpiry(w,L.bind(null,!0));break;default:L(!0);break}}n.removeListeners=function(){socket.removeListener("event:topic_deleted",j),socket.removeListener("event:topic_restored",j),socket.removeListener("event:topic_purged",h),socket.removeListener("event:topic_locked",i),socket.removeListener("event:topic_unlocked",i),socket.removeListener("event:topic_pinned",F),socket.removeListener("event:topic_unpinned",F),socket.removeListener("event:topic_moved",c)};function r(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function t(){r(),C.unselectAll()}function f(){r(),s()}function s(){const e=C.getSelectedTids(),o=y(S,e),d=R(S,e),A=y(B,e),k=y(M,e),w=y(W,e),L=R(W,e);a.get("topic/delete").toggleClass("hidden",o),a.get("topic/restore").toggleClass("hidden",w||!o),a.get("topic/purge").toggleClass("hidden",!d),a.get("topic/lock").toggleClass("hidden",k),a.get("topic/unlock").toggleClass("hidden",!k),a.get("topic/pin").toggleClass("hidden",L||A),a.get("topic/unpin").toggleClass("hidden",L||!A),a.get("topic/merge").toggleClass("hidden",w)}function y(e,o){for(let d=0;d<o.length;d+=1)if(e(o[d]))return!0;return!1}function R(e,o){for(let d=0;d<o.length;d+=1)if(!e(o[d]))return!1;return!0}function S(e){return I(e).hasClass("deleted")}function M(e){return I(e).hasClass("locked")}function B(e){return I(e).hasClass("pinned")}function W(e){return I(e).hasClass("scheduled")}function I(e){return a.get("category/topic","tid",e)}function j(e){const o=I(e.tid);o.toggleClass("deleted",e.isDeleted),o.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function F(e){const o=I(e.tid);o.toggleClass("pinned",e.isPinned),o.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned),ajaxify.refresh()}function i(e){const o=I(e.tid);o.toggleClass("locked",e.isLocked),o.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function c(e){I(e.tid).remove()}function h(e){I(e.tid).remove()}function v(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(o=>o.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const o=$('[component="category"]').filter(function(A,k){return!$(k).parents("[widget-area],[data-widget-area]").length});let d=0;o.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){d=parseInt(o.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(A,k){socket.emit("topics.orderPinnedTopics",{tid:k.item.attr("data-tid"),order:d+k.item.index()},function(w){if(w)return u.error(w);o.find('[component="category/topic"].pinned').each((L,N)=>{$(N).attr("data-index",d+L)})})}})})}return n}.apply(D,x),m!==void 0&&(P.exports=m)},39941:(P,D,g)=>{var x,m;x=[g(22905),g(74344),g(85233)],m=function(C,T,a){const p={};p.init=function(u,n){if(!u||!u.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template="partials/category-filter",a.fire("action:category.filter.options",{el:u,options:n}),C.init(u,n);let l=[],r=[];Array.isArray(n.selectedCids)?l=n.selectedCids.map(t=>parseInt(t,10)):Array.isArray(ajaxify.data.selectedCids)&&(l=ajaxify.data.selectedCids.map(t=>parseInt(t,10))),r=l.slice(),u.on("hidden.bs.dropdown",function(){let t=r.length!==l.length;if(r.forEach(function(f,s){f!==l[s]&&(t=!0)}),t&&E(u,l),n.onHidden){n.onHidden({changed:t,selectedCids:l.slice()});return}if(t){let f=window.location.pathname;const s=utils.params();l.length&&(s.cid=l,f+="?"+decodeURIComponent($.param(s))),ajaxify.go(f)}}),u.on("click",'[component="category/list"] [data-cid]',function(){const t=u.find('[component="category/list"]'),f=$(this),s=f.find("a").attr("href");if(s&&s!=="#"&&s.length)return;const y=parseInt(f.attr("data-cid"),10),R=f.find('[component="category/select/icon"]');return l.includes(y)?l.splice(l.indexOf(y),1):l.push(y),l.sort(function(S,M){return S-M}),n.selectedCids=l,R.toggleClass("invisible"),t.find('li[data-all="all"] i').toggleClass("invisible",!!l.length),n.onSelect&&n.onSelect({cid:y,selectedCids:l.slice()}),!1})};function E(u,n){n.length>1?l({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?T.get(`/categories/${n[0]}`,{}).then(l):l();function l(r){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:r},function(t){u.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return p}.apply(D,x),m!==void 0&&(P.exports=m)},22905:(P,D,g)=>{var x,m;x=[g(7927)],m=function(C){const T={};return T.init=function(a,p){let E=null;p=p||{},p.privilege=p.privilege||"topics:read",p.states=p.states||["watching","notwatching","ignoring"];let u=[];Array.isArray(p.localCategories)&&(u=p.localCategories.map(f=>({...f}))),p.selectedCids=p.selectedCids||ajaxify.data.selectedCids||[];const n=a.find('[component="category-selector-search"]');if(!n.length)return;const l=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;a.on("show.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").addClass("hidden"),n.removeClass("hidden"));function f(){const s=n.find("input").val();s.length>1||!s&&!E?r(s,function(y){E=E||y,t(y)}):!s&&E&&(E.forEach(function(y){y.selected=p.selectedCids.includes(y.cid)}),t(E))}n.on("click",function(s){s.preventDefault(),s.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(f,300)),f()}),a.on("shown.bs.dropdown",function(){n.find("input").focus()}),a.on("hide.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").removeClass("hidden"),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function r(f,s){socket.emit("categories.categorySearch",{search:f,query:utils.params(),parentCid:p.parentCid||0,selectedCids:p.selectedCids,privilege:p.privilege,states:p.states,showLinks:p.showLinks},function(y,R){if(y)return C.error(y);s(u.concat(R))})}function t(f){app.parseAndTranslate(p.template,{categoryItems:f.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){a.find('[component="category/list"]').replaceWith(s.find('[component="category/list"]')),a.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!f.length)})}},T}.apply(D,x),m!==void 0&&(P.exports=m)},14745:(P,D,g)=>{var x,m;x=[g(25142),g(66044),g(69941),g(39941),g(29412),g(85233)],m=function(C,T,a,p,E,u){const n={};let l="",r=0,t=0,f,s;const y=[];$(window).on("action:ajaxify.start",function(){n.removeListeners(),E.removeListeners()}),n.init=function(i,c){console.log("HIHIHH"),n.getTopicsBySearch(),s=R(),l=i,f=c||I,E.init(),n.watchForNewPosts();const h=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?h.push("notwatching","ignoring"):i!=="unread"&&h.push("notwatching"),p.init($('[component="category/dropdown"]'),{states:h}),config.usePagination||C.init(n.loadMoreTopics),T.init(function(v,e){f(v,1,function(o,d){F(l,o.topics,ajaxify.data.showSelect,1,function(){e(),d()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){n.loadMoreTopics(1)}),u.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function R(){return $('[component="category"]').filter(function(i,c){return!$(c).parents("[widget-area],[data-widget-area]").length})}n.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),t=0,r=0,n.removeListeners(),socket.on("event:new_topic",S),socket.on("event:new_post",M)},n.getTopicsBySearch=async function(){let i="werweAnnouncement 1";if(console.log(i),console.log("INSIDE SEARCH"),!i||String(i).length<2)return[];const c=await db.getSortedSetScan({key:"category:title",match:`*${String(i).toLowerCase()}*`,limit:hardCap||500});res=c.map(h=>parseInt(h.split(":").pop(),10)),console.log(res)},n.removeListeners=function(){socket.removeListener("event:new_topic",S),socket.removeListener("event:new_post",M)};function S(i){const c=ajaxify.data,h=c.selectedCids&&c.selectedCids.length&&c.selectedCids.indexOf(parseInt(i.cid,10))===-1,v=c.selectedFilter&&c.selectedFilter.filter==="watched",e=c.template.category&&parseInt(c.cid,10)!==parseInt(i.cid,10),o=!!(h||v||e||y.includes(i.tid));u.fire("filter:topicList.onNewTopic",{topic:i,preventAlert:o}).then(d=>{d.preventAlert||(i.scheduled&&i.tid&&y.push(i.tid),r+=1,B())})}function M(i){const c=i.posts[0];if(!c||!c.topic||c.topic.isFollowing)return;const h=ajaxify.data,v=parseInt(c.topic.mainPid,10)===parseInt(c.pid,10),e=h.selectedCids&&h.selectedCids.length&&h.selectedCids.indexOf(parseInt(c.topic.cid,10))===-1,o=h.selectedFilter&&h.selectedFilter.filter==="new",d=h.selectedFilter&&h.selectedFilter.filter==="watched"&&!c.topic.isFollowing,A=h.template.category&&parseInt(h.cid,10)!==parseInt(c.topic.cid,10),k=!!(v||e||o||d||A);u.fire("filter:topicList.onNewPost",{post:c,preventAlert:k}).then(w=>{w.preventAlert||(t+=1,B())})}function B(){let i="";r===0?t===1?i="[[recent:there-is-a-new-post]]":t>1&&(i="[[recent:there-are-new-posts, "+t+"]]"):r===1?t===0?i="[[recent:there-is-a-new-topic]]":t===1?i="[[recent:there-is-a-new-topic-and-a-new-post]]":t>1&&(i="[[recent:there-is-a-new-topic-and-new-posts, "+t+"]]"):r>1&&(t===0?i="[[recent:there-are-new-topics, "+r+"]]":t===1?i="[[recent:there-are-new-topics-and-a-new-post, "+r+"]]":t>1&&(i="[[recent:there-are-new-topics-and-new-posts, "+r+", "+t+"]]")),i+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(i).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}n.loadMoreTopics=function(i){if(!s.length||!s.children().length)return;const c=s.find('[component="category/topic"]'),h=i>0?c.last():c.first(),v=(parseInt(h.attr("data-index"),10)||0)+(i>0?1:0);!utils.isNumber(v)||v===0&&s.find('[component="category/topic"][data-index="0"]').length||f(v,i,function(e,o){F(l,e.topics,ajaxify.data.showSelect,i,o)})};function W(i,c){return Math.floor(i/config.topicsPerPage)+(c>0?1:0)}function I(i,c,h){h=h||function(){};const v=utils.params();v.page=W(i,c),C.loadMoreXhr(v,h)}function j(i){return i.filter(function(c){return!s.find('[component="category/topic"][data-tid="'+c.tid+'"]').length})}function F(i,c,h,v,e){if(!c||!c.length||(c=j(c),!c.length))return $("#load-more-btn").hide(),e();let o,d;const A=s.find('[component="category/topic"]');v>0&&c.length?o=A.last():v<0&&c.length&&(d=A.first());const k={topics:c,showSelect:h,template:{name:i}};k.template[i]=!0,u.fire("action:topics.loading",{topics:c,after:o,before:d}),app.parseAndTranslate(i,"topics",k,function(w){if(s.removeClass("hidden"),$("#category-no-topics").remove(),o&&o.length)w.insertAfter(o);else if(d&&d.length){const L=$(document).height(),N=$(window).scrollTop();w.insertBefore(d),$(window).scrollTop(N+($(document).height()-L))}else s.append(w);a.getSelectedTids().length||C.removeExtra(s.find('[component="category/topic"]'),v,Math.max(60,config.topicsPerPage*3)),w.find(".timeago").timeago(),app.createUserTooltips(w),utils.makeNumbersHumanReadable(w.find(".human-readable-number")),u.fire("action:topics.loaded",{topics:c,template:i}),e()})}return n}.apply(D,x),m!==void 0&&(P.exports=m)},69941:(P,D,g)=>{var x,m;x=[g(7237)],m=function(C){const T={};let a,p;T.init=function(r){p=$('[component="category"]'),p.on("selectstart",'[component="topic/select"]',function(t){t.preventDefault()}),p.on("click",'[component="topic/select"]',function(t){const f=$(this);if(t.shiftKey)return u($(this).parents('[component="category/topic"]').attr("data-tid")),a=f,!1;const s=f.parents("[data-tid]").hasClass("selected");E(f,!s),a=f,typeof r=="function"&&r()})};function E(r,t){r.toggleClass("fa-check-square-o",t),r.toggleClass("fa-square-o",!t),r.parents('[component="category/topic"]').toggleClass("selected",t)}T.getSelectedTids=function(){const r=[];return p&&p.find('[component="category/topic"].selected').each(function(){r.push($(this).attr("data-tid"))}),r},T.unselectAll=function(){p&&(p.find('[component="category/topic"].selected').removeClass("selected"),p.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function u(r){a||(a=$('[component="category/topic"]').first().find('[component="topic/select"]'));const t=C.get("category/topic","tid",r).hasClass("selected"),f=l(r),s=l(a.parents('[component="category/topic"]').attr("data-tid"));n(f,s,!t)}function n(r,t,f){if(r>t){const s=r;r=t,t=s}for(let s=r;s<=t;s+=1){const y=$('[component="category/topic"]').eq(s);E(y.find('[component="topic/select"]'),f)}}function l(r){return C.get("category/topic","tid",r).index('[component="category/topic"]')}return T}.apply(D,x),m!==void 0&&(P.exports=m)}}]);
