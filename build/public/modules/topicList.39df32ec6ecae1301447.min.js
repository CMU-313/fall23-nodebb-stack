"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8704,613],{29412:(L,D,g)=>{var w,C;w=[g(69941),g(60392),g(7237),g(74344),g(31369),g(7927)],C=function(A,E,a,p,v,u){const o={};o.init=function(){A.init(s),c(),a.get("topic/delete").on("click",function(){return l("del","/state","delete",f),!1}),a.get("topic/restore").on("click",function(){return l("put","/state","restore",f),!1}),a.get("topic/purge").on("click",function(){return l("del","","purge",f),!1}),a.get("topic/lock").on("click",function(){return l("put","/lock","lock",i),!1}),a.get("topic/unlock").on("click",function(){return l("del","/lock","unlock",i),!1}),a.get("topic/pin").on("click",function(){return l("put","/pin","pin",i),!1}),a.get("topic/unpin").on("click",function(){return l("del","/pin","unpin",i),!1}),a.get("topic/mark-unread-for-all").on("click",function(){const e=A.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(t){if(t)return u.error(t);u.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(d){$('[component="category/topic"][data-tid="'+d+'"]').addClass("unread")}),i()}),!1):u.error("[[error:no-topics-selected]]")}),a.get("topic/move").on("click",function(){return g.e(7378).then(function(){var e=[g(57378)];(function(t){const d=A.getSelectedTids();if(!d.length)return u.error("[[error:no-topics-selected]]");t.init(d,null,i)}).apply(null,e)}).catch(g.oe),!1}),a.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return u.error("[[error:invalid-data]]");g.e(7378).then(function(){var t=[g(57378)];(function(d){d.init(null,e,function(h){if(h)return u.error(h);ajaxify.refresh()})}).apply(null,t)}).catch(g.oe)}),a.get("topic/merge").on("click",function(){const e=A.getSelectedTids();g.e(28).then(function(){var t=[g(90028)];(function(d){d.init(function(){e.length&&e.forEach(function(h){d.addTopic(h)})})}).apply(null,t)}).catch(g.oe)}),o.removeListeners(),socket.on("event:topic_deleted",R),socket.on("event:topic_restored",R),socket.on("event:topic_purged",n),socket.on("event:topic_locked",M),socket.on("event:topic_unlocked",M),socket.on("event:topic_pinned",F),socket.on("event:topic_unpinned",F),socket.on("event:topic_moved",W)};function l(e,t,d,h){h||(h=function(){});const m=A.getSelectedTids(),k={},T=function(I){I&&Promise.all(m.map(b=>p[e](`/topics/${b}${t}`,k))).then(h).catch(u.error)};if(!m.length)return u.error("[[error:no-topics-selected]]");switch(d){case"delete":case"restore":case"purge":v.confirm(`[[topic:thread_tools.${d}_confirm]]`,T);break;case"pin":E.requestPinExpiry(k,T.bind(null,!0));break;default:T(!0);break}}o.removeListeners=function(){socket.removeListener("event:topic_deleted",R),socket.removeListener("event:topic_restored",R),socket.removeListener("event:topic_purged",n),socket.removeListener("event:topic_locked",M),socket.removeListener("event:topic_unlocked",M),socket.removeListener("event:topic_pinned",F),socket.removeListener("event:topic_unpinned",F),socket.removeListener("event:topic_moved",W)};function r(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function i(){r(),A.unselectAll()}function f(){r(),s()}function s(){const e=A.getSelectedTids(),t=y(S,e),d=P(S,e),h=y(B,e),m=y(j,e),k=y(N,e),T=P(N,e);a.get("topic/delete").toggleClass("hidden",t),a.get("topic/restore").toggleClass("hidden",k||!t),a.get("topic/purge").toggleClass("hidden",!d),a.get("topic/lock").toggleClass("hidden",m),a.get("topic/unlock").toggleClass("hidden",!m),a.get("topic/pin").toggleClass("hidden",T||h),a.get("topic/unpin").toggleClass("hidden",T||!h),a.get("topic/merge").toggleClass("hidden",k)}function y(e,t){for(let d=0;d<t.length;d+=1)if(e(t[d]))return!0;return!1}function P(e,t){for(let d=0;d<t.length;d+=1)if(!e(t[d]))return!1;return!0}function S(e){return x(e).hasClass("deleted")}function j(e){return x(e).hasClass("locked")}function B(e){return x(e).hasClass("pinned")}function N(e){return x(e).hasClass("scheduled")}function x(e){return a.get("category/topic","tid",e)}function R(e){const t=x(e.tid);t.toggleClass("deleted",e.isDeleted),t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function F(e){const t=x(e.tid);t.toggleClass("pinned",e.isPinned),t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned),ajaxify.refresh()}function M(e){const t=x(e.tid);t.toggleClass("locked",e.isLocked),t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function W(e){x(e.tid).remove()}function n(e){x(e.tid).remove()}function c(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(t=>t.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const t=$('[component="category"]').filter(function(h,m){return!$(m).parents("[widget-area],[data-widget-area]").length});let d=0;t.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){d=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(h,m){socket.emit("topics.orderPinnedTopics",{tid:m.item.attr("data-tid"),order:d+m.item.index()},function(k){if(k)return u.error(k);t.find('[component="category/topic"].pinned').each((T,I)=>{$(I).attr("data-index",d+T)})})}})})}return o}.apply(D,w),C!==void 0&&(L.exports=C)},39941:(L,D,g)=>{var w,C;w=[g(22905),g(74344),g(85233)],C=function(A,E,a){const p={};p.init=function(u,o){if(!u||!u.length)return;o=o||{},o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-filter",a.fire("action:category.filter.options",{el:u,options:o}),A.init(u,o);let l=[],r=[];Array.isArray(o.selectedCids)?l=o.selectedCids.map(i=>parseInt(i,10)):Array.isArray(ajaxify.data.selectedCids)&&(l=ajaxify.data.selectedCids.map(i=>parseInt(i,10))),r=l.slice(),u.on("hidden.bs.dropdown",function(){let i=r.length!==l.length;if(r.forEach(function(f,s){f!==l[s]&&(i=!0)}),i&&v(u,l),o.onHidden){o.onHidden({changed:i,selectedCids:l.slice()});return}if(i){let f=window.location.pathname;const s=utils.params();l.length&&(s.cid=l,f+="?"+decodeURIComponent($.param(s))),ajaxify.go(f)}}),u.on("click",'[component="category/list"] [data-cid]',function(){const i=u.find('[component="category/list"]'),f=$(this),s=f.find("a").attr("href");if(s&&s!=="#"&&s.length)return;const y=parseInt(f.attr("data-cid"),10),P=f.find('[component="category/select/icon"]');return l.includes(y)?l.splice(l.indexOf(y),1):l.push(y),l.sort(function(S,j){return S-j}),o.selectedCids=l,P.toggleClass("invisible"),i.find('li[data-all="all"] i').toggleClass("invisible",!!l.length),o.onSelect&&o.onSelect({cid:y,selectedCids:l.slice()}),!1})};function v(u,o){o.length>1?l({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):o.length===1?E.get(`/categories/${o[0]}`,{}).then(l):l();function l(r){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:r},function(i){u.find("button").replaceWith($("<div/>").html(i).find("button"))})}}return p}.apply(D,w),C!==void 0&&(L.exports=C)},22905:(L,D,g)=>{var w,C;w=[g(7927)],C=function(A){const E={};return E.init=function(a,p){let v=null;p=p||{},p.privilege=p.privilege||"topics:read",p.states=p.states||["watching","notwatching","ignoring"];let u=[];Array.isArray(p.localCategories)&&(u=p.localCategories.map(f=>({...f}))),p.selectedCids=p.selectedCids||ajaxify.data.selectedCids||[];const o=a.find('[component="category-selector-search"]');if(!o.length)return;const l=o.parent('[component="category/dropdown"]').length>0||o.parent('[component="category-selector"]').length>0;a.on("show.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").addClass("hidden"),o.removeClass("hidden"));function f(){const s=o.find("input").val();s.length>1||!s&&!v?r(s,function(y){v=v||y,i(y)}):!s&&v&&(v.forEach(function(y){y.selected=p.selectedCids.includes(y.cid)}),i(v))}o.on("click",function(s){s.preventDefault(),s.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(f,300)),f()}),a.on("shown.bs.dropdown",function(){o.find("input").focus()}),a.on("hide.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").removeClass("hidden"),o.addClass("hidden")),o.off("click"),o.find("input").off("keyup")});function r(f,s){socket.emit("categories.categorySearch",{search:f,query:utils.params(),parentCid:p.parentCid||0,selectedCids:p.selectedCids,privilege:p.privilege,states:p.states,showLinks:p.showLinks},function(y,P){if(y)return A.error(y);s(u.concat(P))})}function i(f){app.parseAndTranslate(p.template,{categoryItems:f.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){a.find('[component="category/list"]').replaceWith(s.find('[component="category/list"]')),a.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!f.length)})}},E}.apply(D,w),C!==void 0&&(L.exports=C)},14745:(L,D,g)=>{var w,C;w=[g(25142),g(66044),g(69941),g(39941),g(29412),g(85233)],C=function(A,E,a,p,v,u){const o={};let l="",r=0,i=0,f,s;const y=[];$(window).on("action:ajaxify.start",function(){o.removeListeners(),v.removeListeners()}),o.init=function(n,c){console.log("INSIDE TOPICLIST"),P(),s=j(),l=n,f=c||F,v.init(),o.watchForNewPosts();const e=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?e.push("notwatching","ignoring"):n!=="unread"&&e.push("notwatching"),p.init($('[component="category/dropdown"]'),{states:e}),config.usePagination||A.init(o.loadMoreTopics),E.init(function(t,d){f(t,1,function(h,m){W(l,h.topics,ajaxify.data.showSelect,1,function(){d(),m()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){o.loadMoreTopics(1)}),u.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function P(){$("#tag-search").on("input propertychange",utils.debounce(async function(){if(!$("#tag-search").val().length)return resetSearch();if(console.log("HIHIHIIINSIDETAGS"),err)return alerts.error(err);data=$("#tag-search").val();const n=await plugins.hooks.fire("filter:search.query",{content:data.query,matchWords:"all",searchData:data,ids:[]});results=Array.isArray(n)?n:n.ids,console.log(results),S(results,!0)},250))}function S(n,c,e){e=e||function(){},app.parseAndTranslate("topics","topics",{tags:n},function(t){$(".topic-list")[c?"html":"append"](t),utils.makeNumbersHumanReadable(t.find(".human-readable-number")),e()})}function j(){return $('[component="category"]').filter(function(n,c){return!$(c).parents("[widget-area],[data-widget-area]").length})}o.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),i=0,r=0,o.removeListeners(),socket.on("event:new_topic",B),socket.on("event:new_post",N)},o.getTopicsBySearch=async function(){let n="Announcement 1";if(!n||String(n).length<2)return[];const c=await db.getSortedSetScan({key:"category:title",match:`*${String(n).toLowerCase()}*`,limit:hardCap||500});return res=c.map(e=>parseInt(e.split(":").pop(),10)),console.log(res),res},o.removeListeners=function(){socket.removeListener("event:new_topic",B),socket.removeListener("event:new_post",N)};function B(n){const c=ajaxify.data,e=c.selectedCids&&c.selectedCids.length&&c.selectedCids.indexOf(parseInt(n.cid,10))===-1,t=c.selectedFilter&&c.selectedFilter.filter==="watched",d=c.template.category&&parseInt(c.cid,10)!==parseInt(n.cid,10),h=!!(e||t||d||y.includes(n.tid));u.fire("filter:topicList.onNewTopic",{topic:n,preventAlert:h}).then(m=>{m.preventAlert||(n.scheduled&&n.tid&&y.push(n.tid),r+=1,x())})}function N(n){const c=n.posts[0];if(!c||!c.topic||c.topic.isFollowing)return;const e=ajaxify.data,t=parseInt(c.topic.mainPid,10)===parseInt(c.pid,10),d=e.selectedCids&&e.selectedCids.length&&e.selectedCids.indexOf(parseInt(c.topic.cid,10))===-1,h=e.selectedFilter&&e.selectedFilter.filter==="new",m=e.selectedFilter&&e.selectedFilter.filter==="watched"&&!c.topic.isFollowing,k=e.template.category&&parseInt(e.cid,10)!==parseInt(c.topic.cid,10),T=!!(t||d||h||m||k);u.fire("filter:topicList.onNewPost",{post:c,preventAlert:T}).then(I=>{I.preventAlert||(i+=1,x())})}function x(){let n="";r===0?i===1?n="[[recent:there-is-a-new-post]]":i>1&&(n="[[recent:there-are-new-posts, "+i+"]]"):r===1?i===0?n="[[recent:there-is-a-new-topic]]":i===1?n="[[recent:there-is-a-new-topic-and-a-new-post]]":i>1&&(n="[[recent:there-is-a-new-topic-and-new-posts, "+i+"]]"):r>1&&(i===0?n="[[recent:there-are-new-topics, "+r+"]]":i===1?n="[[recent:there-are-new-topics-and-a-new-post, "+r+"]]":i>1&&(n="[[recent:there-are-new-topics-and-new-posts, "+r+", "+i+"]]")),n+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(n).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}o.loadMoreTopics=function(n){if(!s.length||!s.children().length)return;const c=s.find('[component="category/topic"]'),e=n>0?c.last():c.first(),t=(parseInt(e.attr("data-index"),10)||0)+(n>0?1:0);!utils.isNumber(t)||t===0&&s.find('[component="category/topic"][data-index="0"]').length||f(t,n,function(d,h){W(l,d.topics,ajaxify.data.showSelect,n,h)})};function R(n,c){return Math.floor(n/config.topicsPerPage)+(c>0?1:0)}function F(n,c,e){e=e||function(){};const t=utils.params();t.page=R(n,c),A.loadMoreXhr(t,e)}function M(n){return n.filter(function(c){return!s.find('[component="category/topic"][data-tid="'+c.tid+'"]').length})}function W(n,c,e,t,d){if(!c||!c.length||(c=M(c),!c.length))return $("#load-more-btn").hide(),d();let h,m;const k=s.find('[component="category/topic"]');t>0&&c.length?h=k.last():t<0&&c.length&&(m=k.first());const T={topics:c,showSelect:e,template:{name:n}};T.template[n]=!0,u.fire("action:topics.loading",{topics:c,after:h,before:m}),app.parseAndTranslate(n,"topics",T,function(I){if(s.removeClass("hidden"),$("#category-no-topics").remove(),h&&h.length)I.insertAfter(h);else if(m&&m.length){const b=$(document).height(),U=$(window).scrollTop();I.insertBefore(m),$(window).scrollTop(U+($(document).height()-b))}else s.append(I);a.getSelectedTids().length||A.removeExtra(s.find('[component="category/topic"]'),t,Math.max(60,config.topicsPerPage*3)),I.find(".timeago").timeago(),app.createUserTooltips(I),utils.makeNumbersHumanReadable(I.find(".human-readable-number")),u.fire("action:topics.loaded",{topics:c,template:n}),d()})}return o}.apply(D,w),C!==void 0&&(L.exports=C)},69941:(L,D,g)=>{var w,C;w=[g(7237)],C=function(A){const E={};let a,p;E.init=function(r){p=$('[component="category"]'),p.on("selectstart",'[component="topic/select"]',function(i){i.preventDefault()}),p.on("click",'[component="topic/select"]',function(i){const f=$(this);if(i.shiftKey)return u($(this).parents('[component="category/topic"]').attr("data-tid")),a=f,!1;const s=f.parents("[data-tid]").hasClass("selected");v(f,!s),a=f,typeof r=="function"&&r()})};function v(r,i){r.toggleClass("fa-check-square-o",i),r.toggleClass("fa-square-o",!i),r.parents('[component="category/topic"]').toggleClass("selected",i)}E.getSelectedTids=function(){const r=[];return p&&p.find('[component="category/topic"].selected').each(function(){r.push($(this).attr("data-tid"))}),r},E.unselectAll=function(){p&&(p.find('[component="category/topic"].selected').removeClass("selected"),p.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function u(r){a||(a=$('[component="category/topic"]').first().find('[component="topic/select"]'));const i=A.get("category/topic","tid",r).hasClass("selected"),f=l(r),s=l(a.parents('[component="category/topic"]').attr("data-tid"));o(f,s,!i)}function o(r,i,f){if(r>i){const s=r;r=i,i=s}for(let s=r;s<=i;s+=1){const y=$('[component="category/topic"]').eq(s);v(y.find('[component="topic/select"]'),f)}}function l(r){return A.get("category/topic","tid",r).index('[component="category/topic"]')}return E}.apply(D,w),C!==void 0&&(L.exports=C)}}]);
